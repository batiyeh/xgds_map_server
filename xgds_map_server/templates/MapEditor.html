{% extends "base.html" %}
{% load pipeline %}

{% block sitemenu-content-secondary %}
{% include "map_subnav.html" %}
{% endblock %}

{% block siteSection %}Edit {{ plan_name }}{% endblock %}


{% block content %}
<style scoped>
  {# stylesheet 'planner_app' #}
  @import url('{{EXTERNAL_URL}}jquery-ui/themes/base/jquery-ui.css');
  @import url('{{EXTERNAL_URL}}ol3-popup/src/ol3-popup.css');
  @import url('{{STATIC_URL}}xgds_planner2/css/planner.css');
                             
  /* for some reason compressing this in the css does not work so it's separate in the planner_app */
  @import url('{{ EXTERNAL_URL }}kmltree/kmltree.css');
  @import url('{{ EXTERNAL_URL }}backbone-forms/distribution/templates/old.css');
  @import url('{{ EXTERNAL_URL }}ol3/css/ol.css');
  @import url('{{ EXTERNAL_URL }}fancytree/dist/skin-lion/ui.fancytree.min.css');
  @import url('{{ STATIC_URL }}xgds_map_server/css/fancytree_custom.css');
  @import url('{{ STATIC_URL }}xgds_planner2/css/forms_adjust.css');
      .map {
        height: 400px;
        width: 100%;
      }
</style>

<div id="application" >
    <div id="toolbar" class="row">
    </div>

    <div class="row">
        <div id="map" class="five columns"></div>
        <div id="tabs" class="seven columns"></div>       
    </div>
    
    <div id="saveAsDialog" style="display:none; background:white !important;">
		<p>Enter a new map layer name to save as.</p>
		<table>
		<tr>
			<td><label for="saveAsName">Name</label></td>
			<td><input type="text" id="saveAsName"></td>
		</tr>
		<tr></tr>
		</table>
	</div>
	<div class="row">
    <div id="editingTools"></div>
	</div>
    
</div>
{% endblock content %}
  

{% block scripts %}
    {# javascript 'planner_app' #}
    <script type="text/javascript" src='{{ EXTERNAL_URL }}jquery/dist/jquery.min.js'></script>
     <script type="text/javascript" src='{{ EXTERNAL_URL }}jquery-migrate/index.js'></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}jquery-ui/jquery-ui.min.js'></script>
	<script type="text/javascript" src='{{ EXTERNAL_URL }}jquery-cookie/jquery.cookie.js'></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}fancytree/dist/jquery.fancytree.js'></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}fancytree/dist/src/jquery.fancytree.persist.js'></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}lodash/lodash.min.js'></script>
    
    <script type="text/javascript" src='{{ EXTERNAL_URL }}handlebars/handlebars.min.js'></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}backbone/backbone.js'></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}backbone-relational/backbone-relational.js'></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}backbone-forms/distribution/backbone-forms.min.js'></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}marionette/lib/backbone.marionette.min.js'></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}string-format/string-format.js'></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}usng/usng.js'></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}proj4/dist/proj4.js'></script>

 	<script src="{{EXTERNAL_URL}}ol3/build/ol-debug.js" type="text/javascript"></script>
    <script type="text/javascript" src='{{ EXTERNAL_URL }}ol3-popup/src/ol3-popup.js'></script>

    <script type="text/javascript" src='{{STATIC_URL}}xgds_map_server/js/app.js'></script>    
   	<script type="text/javascript" src='{{STATIC_URL}}xgds_map_server/js/fancyTreeView.js'></script>
   	<script type="text/javascript" src='{{STATIC_URL}}xgds_map_server/js/olMapViews.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}xgds_map_server/js/geo.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}xgds_map_server/js/forms.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}xgds_map_server/js/models.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}xgds_map_server/js/views.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}xgds_map_server/js/olMapEditorViews.js'></script>

   	
    {% for template_name, template in templates.items %}
		<script type="text/handlebars" id="template-{{template_name}}">
		{{template|safe}}
		</script>
    {% endfor %}
    
{% endblock scripts %}

{% block jsInit %}
    appOptions = {
        offline: {{ settings.XGDS_PLANNER_OFFLINE|yesno:"true,false" }},
        layerFeedUrl: "{{ settings.XGDS_MAP_SERVER_LAYER_FEED_URL }}",
        dataUrl: "{{ settings.DATA_URL }}",
        readOnly: {{ editable|yesno:"false,true" }},
        mapLayerDict: {{ mapLayerDict|safe }},
        siteFrame: {{ settings.XGDS_CURRENT_SITEFRAME|safe }},
        saveFeatureUrl: "{{ saveFeatureUrl }}", 
        saveMaplayerUrl: "{{ saveMaplayerUrl }}"
    };
	
	$(function(){
	    app.start(appOptions);
	})
	
	$(window).bind('beforeunload', function() {
        if (app.dirty) {
            return 'Unsaved changes, are you sure you want to exit?';
        }
    }); 
    
{% endblock jsInit %}
  
