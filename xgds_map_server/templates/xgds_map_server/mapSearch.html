{% extends 'dashboard_base.html' %}

{% block cssExtras %}
{{ block.super }}
<style type="text/css" title="currentStyle">
	@import url('{{EXTERNAL_URL}}jqueryui-timepicker-addon/dist/jquery-ui-timepicker-addon.css');
</style>
{% endblock cssExtras %}

{% block scripts %}
{{block.super}}
	<script language="javascript" type="text/javascript" src="{{ EXTERNAL_URL }}jqueryui-timepicker-addon/dist/jquery-ui-timepicker-addon.min.js"></script>
	<script type="text/javascript" src='{{ STATIC_URL }}xgds_core/js/datetimepickerUtils.js'></script>
    <script type="text/javascript" src="{{ STATIC_URL }}xgds_map_server/js/map_search/search.js"></script>
    {% for template_name, template in templates.items %}
	<script type="text/handlebars" id="template-{{template_name}}">
		{{template|safe}}
	</script>
    {% endfor %}
    {% include "xgds_map_server/SearchForms.html" with searchForms=searchForms %}
    
{% endblock scripts %}


{% block jsInit %}
	var siteFrames = {{settings.XGDS_SITEFRAMES|safe}};
	appOptions = {
		BODY_RADIUS_METERS: {{ settings.XGDS_MAP_SERVER_BODY_RADIUS_METERS }},
		DEFAULT_COORD_SYSTEM: "{{ settings.XGDS_MAP_SERVER_DEFAULT_COORD_SYSTEM }}",
		SETUP_COORD_SYSTEM: {{ settings.XGDS_MAP_SERVER_MAP_SETUP_COORD_SYSTEM }},
		DEFAULT_COORD_SYSTEM_CENTER: {{ settings.XGDS_MAP_SERVER_DEFAULT_COORD_SYSTEM_CENTER }},
		DEFAULT_ZOOM: {{ settings.XGDS_MAP_SERVER_DEFAULT_ZOOM }},
		DEFAULT_ROTATION: {{ settings.XGDS_MAP_SERVER_DEFAULT_ROTATION }},
		SHOW_COMPASS: {{ settings.XGDS_MAP_SERVER_SHOW_COMPASS}},
		selectedLayerUrl: "{{ settings.XGDS_MAP_SERVER_SELECTED_LAYER_URL }}",
		layerFeedUrl: "{{ settings.XGDS_MAP_SERVER_LAYER_FEED_URL }}",
		siteFrame: {{ settings.XGDS_CURRENT_SITEFRAME|safe }},
		XGDS_MAP_SERVER_MAP_LOADED_CALLBACK: {{ settings.XGDS_MAP_SERVER_MAP_LOADED_CALLBACK }},
		dataUrl: "{{ settings.DATA_URL }}",
		searchModels: {{ settings.XGDS_MAP_SERVER_JS_MAP|safe }},
		modelName: '{{modelName}}'
	};
	{% block jsInitPreApp %}
	{% endblock jsInitPreApp %}
	
	$(function(){
		app.start(appOptions);
    	app.vent.on("mapSearch:drewFeatures", function(e) {
        	app.vent.trigger('mapSearch:fit');
        });
        
        {% block prePackery %}
		{% endblock prePackery %}
		
    	initializePackery();
    	
    	{% block otherJSInit %}
    		matchWidth('item_search','map');
		{% endblock otherJSInit %}
		
		
		
	});
	
{% endblock %}

{% block content %}
	{% block packery %}
	<div id="container">
		<div id="map" class="item w2 auto freeAspect">
			<i class="icon-lock-open pinDiv warning"></i>
			{% if settings.XGDS_SITEFRAMES|length > 1 %}	
        		{{selectSiteFrameForm}}
        	{% endif %}
		</div>
		
		<div id="searchDiv">
		</div> 
		
		{% block firstPackery %}
		{% endblock firstPackery %}
		
		
		{% block lastPackery %}
		{% endblock lastPackery %}
		
		
		
		<div id="layers" class="item auto freeAspect"></div>
	</div> <!--  js packery container -->
	</div> <!--  searchdiv -->
	{% endblock packery %}
{% endblock content %}
