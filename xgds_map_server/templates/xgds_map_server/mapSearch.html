{% extends 'dashboard_base.html' %}

{% block sitemenu-content-secondary %}
	{% include "xgds_map_server/mapSearch_subnav.html" %}
{% endblock %}

{% load siteFrames %}

{% block cssExtras %}
{{ block.super }}
{% include "xgds_notes2/NoteCSS.html" %}
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}jqueryui-timepicker-addon/dist/jquery-ui-timepicker-addon.css" ></link>
<link href="/static/autocomplete_light/vendor/select2/dist/css/select2.css" type="text/css" media="all" rel="stylesheet" />
<link href="/static/autocomplete_light/select2.css" type="text/css" media="all" rel="stylesheet" />
{% endblock cssExtras %}

{% block scripts %}
{{block.super}}
	{% block notejs %}
	{% include "xgds_notes2/NoteJS.html" with forceUserSession=forceUserSession%}
	{% endblock notejs %}
	<script type="text/javascript" src="{{ EXTERNAL_URL }}jqueryui-timepicker-addon/dist/jquery-ui-timepicker-addon.min.js"></script>
	<script type="text/javascript" src='{{ STATIC_URL }}xgds_core/js/datetimepickerUtils.js'></script>
	<script type="text/javascript" src="/static/autocomplete_light/jquery.init.js"></script>
	<script type="text/javascript" src="/static/autocomplete_light/autocomplete.init.js"></script>
	<script type="text/javascript" src="/static/autocomplete_light/vendor/select2/dist/js/select2.full.js"></script>
	<script type="text/javascript" src="/static/autocomplete_light/forward.js"></script>
	<script type="text/javascript" src="/static/autocomplete_light/select2.js"></script>
    {% for template_name, template in templates.items %}
	<script type="text/handlebars" id="template-{{template_name}}">
		{{template|safe}}
	</script>
    {% endfor %}
    {% include "xgds_map_server/SearchForms.html" with searchForms=searchForms %}
{% endblock scripts %}

{% block jsInit %}
	var siteFrames = {% siteframes_dict %};
	appOptions = {
		BODY_RADIUS_METERS: {{ settings.XGDS_MAP_SERVER_BODY_RADIUS_METERS }},
		DEFAULT_COORD_SYSTEM: "{{ settings.XGDS_MAP_SERVER_DEFAULT_COORD_SYSTEM }}",
		SETUP_COORD_SYSTEM: {{ settings.XGDS_MAP_SERVER_MAP_SETUP_COORD_SYSTEM }},
		DEFAULT_COORD_SYSTEM_CENTER: {{ settings.XGDS_MAP_SERVER_DEFAULT_COORD_SYSTEM_CENTER }},
		DEFAULT_ZOOM: {{ settings.XGDS_MAP_SERVER_DEFAULT_ZOOM }},
		DEFAULT_ROTATION: {{ settings.XGDS_MAP_SERVER_DEFAULT_ROTATION }},
		SHOW_COMPASS: {{ settings.XGDS_MAP_SERVER_SHOW_COMPASS}},
		selectedLayerUrl: "{{ settings.XGDS_MAP_SERVER_SELECTED_LAYER_URL }}",
		layerFeedUrl: "{{ settings.XGDS_MAP_SERVER_LAYER_FEED_URL }}",
		siteFrame: {% siteframe settings.XGDS_CURRENT_SITEFRAME_ID %},
		XGDS_MAP_SERVER_MAP_LOADED_CALLBACK: {{ settings.XGDS_MAP_SERVER_MAP_LOADED_CALLBACK }},
		dataUrl: "{{ settings.DATA_URL }}",
		searchModels: {{ searchModelDict|safe }},
		modelName: '{{modelName}}',
		tableHeight: Math.floor($(window).height()*.7) + 'px',
		{% block extraAppOptions %}
		{% endblock extraAppOptions %}
		settingsLive: {{ settings.GEOCAM_UTIL_LIVE_MODE|yesno:"true,false" }}
	};
	{% block jsInitPreApp %}
	{% endblock jsInitPreApp %}
	
	$(function(){
		app.start(appOptions);
    	app.vent.on("mapSearch:drewFeatures", function(e) {
        	app.vent.trigger('mapSearch:fit');
        });
        
        {% block preLayout %}
		{% endblock preLayout %}
		
    	xgds_gridstack.initializeGridstack();
    	xgds_search.hookAdvancedSearchButton();
    	
    	var searchDiv_initialized = false;
		 app.vent.on('searchDiv:visible', function(){
		 	if (!searchDiv_initialized){
		        addDateTimePickers();
		        searchDiv_initialized = true;
		 	} 
		 });
    	{% block otherJSInit %}
		{% endblock otherJSInit %}
		
	});
	
{% endblock jsInit %}

{% block preDashboard %}
<div id="buttonRow" class="row" style="padding-bottom:5px;">
{% block buttonRow %}
<button id="advanced_search_button" class="small pull_right">Advanced Search</button>
{% endblock buttonRow %}
</div>
{% endblock preDashboard %}

{% block preMap %}

{% block searchDiv %}
<div id="search-gridstack-item" class="grid-stack-item" 
		data-gs-x="0" data-gs-y="0"
        data-gs-width="3" data-gs-height="2" hidden="true">
        <div class="grid-stack-item-content" id="search-gridstack-item-content" >
	        <i class="icon-lock pinDiv warning"></i>
	    	<i class="icon-cancel-circled"></i>
			<div id="searchDiv" hidden="true"></div>
		</div>
</div>
{% endblock searchDiv %}

{% block searchResultsDiv %}
<div id="search-results-gridstack-item" class="grid-stack-item" 
		data-gs-x="0" data-gs-y="0"
        data-gs-width="3" data-gs-height="3" >
        <div class="grid-stack-item-content" id="search-results-gridstack-item-content" >
        <!-- <input type="checkbox" id="today" value="today" checked>Today -->
        <i class="icon-lock pinDiv warning"></i>
		<i class="icon-cancel-circled"></i>
		<i class="icon-arrows-ccw right" title="Reload Latest" id="reloadSearchResults"></i>
			<div id="searchResultsDiv"></div>
		</div>
</div>
{% endblock searchResultsDiv %}


{% block viewDiv %}
<div id="view-gridstack-item" class="grid-stack-item" 
		data-gs-x="3" data-gs-y="0"
        data-gs-width="3" data-gs-height="3" >
        <div class="grid-stack-item-content" id="view-gridstack-item-content" >
			<i class="icon-lock pinDiv warning"></i>
			<i class="icon-cancel-circled"></i>
			<div class="small default btn icon-right entypo icon-window" id="new-window-btn">
				<a href="#" id="view-new-window-target" target="_blank">New Window</a>
			</div>
			<button class="small info btn prev-button" id="prev_button"><i class="icon-left-dir"></i></button>
			<strong id="nameBlock"></strong>
			<button class="small info btn next-button" id="next_button"><i class="icon-right-dir"></i></button>
			<div id="viewDiv">
			</div>
			<div id="notesDiv">
			</div>
		</div>
</div> 
{% endblock viewDiv %}
{% endblock preMap %}

{% block map %}
<div id="map-gridstack-item" class="grid-stack-item" 
	  data-gs-x="3" data-gs-y="4"
      data-gs-width="2" data-gs-height="1" >
	<div class="grid-stack-item-content" id="map-gridstack-item-content" >
	<i class="icon-lock pinDiv warning"></i>
      		{% siteframe_form %}
		<div id="map"></div>
	</div>
</div>
{% endblock map %}

{% block layers %}
<div id="map-gridstack-item" class="grid-stack-item" 
	  data-gs-x="6" data-gs-y="4"
      data-gs-width="1" data-gs-height="1" >
	<div class="grid-stack-item-content" id="layers-gridstack-item-content">
	<i class="icon-cancel-circled"></i>
	<i class="icon-lock-open pinDiv warning"></i>
	<div id="layers"></div>
	</div>
</div>
{% endblock layers %}

		

